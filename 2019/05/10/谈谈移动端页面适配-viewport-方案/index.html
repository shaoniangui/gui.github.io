<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>谈谈移动端页面适配(viewport)方案 | 少年癸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. viewport是什么？Viewport(视窗)，指浏览器可视化的区域。viewport的大小决定了，在CSS中设置多少像素能占满浏览器窗口。例如：viewport = 320,那么div的宽度为320px的话则能占满屏幕宽度。 1.1 浏览器可视化区域视窗(Viewport)指的是浏览器可视化区域，如下图中的windows.innerWidth/windows.innerHeight浏览器">
<meta property="og:type" content="article">
<meta property="og:title" content="谈谈移动端页面适配(viewport)方案">
<meta property="og:url" content="http://yoursite.com/2019/05/10/谈谈移动端页面适配-viewport-方案/index.html">
<meta property="og:site_name" content="少年癸">
<meta property="og:description" content="1. viewport是什么？Viewport(视窗)，指浏览器可视化的区域。viewport的大小决定了，在CSS中设置多少像素能占满浏览器窗口。例如：viewport = 320,那么div的宽度为320px的话则能占满屏幕宽度。 1.1 浏览器可视化区域视窗(Viewport)指的是浏览器可视化区域，如下图中的windows.innerWidth/windows.innerHeight浏览器">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-4.png">
<meta property="og:image" content="https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-5.png">
<meta property="og:image" content="https://i.loli.net/2019/04/10/5cad4ec8904fd.png">
<meta property="og:updated_time" content="2019-09-27T20:01:58.412Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="谈谈移动端页面适配(viewport)方案">
<meta name="twitter:description" content="1. viewport是什么？Viewport(视窗)，指浏览器可视化的区域。viewport的大小决定了，在CSS中设置多少像素能占满浏览器窗口。例如：viewport = 320,那么div的宽度为320px的话则能占满屏幕宽度。 1.1 浏览器可视化区域视窗(Viewport)指的是浏览器可视化区域，如下图中的windows.innerWidth/windows.innerHeight浏览器">
<meta name="twitter:image" content="https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-4.png">
  
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block);
      });
    });
  </script>
  <link rel="stylesheet" href="/css/index.css">
</head>
</html>
<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">shaonian.gui</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">谈谈移动端页面适配(viewport)方案</h2>
  <p class="sub">May 10, 2019</p>
  <article class="content">
    <h2 id="1-viewport是什么？"><a href="#1-viewport是什么？" class="headerlink" title="1. viewport是什么？"></a>1. viewport是什么？</h2><p>Viewport(视窗)，指浏览器可视化的区域。<br>viewport的大小决定了，在CSS中设置多少像素能占满浏览器窗口。<br>例如：viewport = 320,那么div的宽度为320px的话则能占满屏幕宽度。</p>
<h3 id="1-1-浏览器可视化区域"><a href="#1-1-浏览器可视化区域" class="headerlink" title="1.1 浏览器可视化区域"></a>1.1 浏览器可视化区域</h3><p>视窗(Viewport)指的是浏览器可视化区域，如下图中的windows.innerWidth/windows.innerHeight<br>浏览器支持：淘宝2015年的<code>Flexible</code>方案是通过<strong>JavaScript</strong>来模拟<strong>vw</strong>的特性，而到今天，视窗单位<strong>vw</strong>已经得到了众多浏览器的支持，可以直接考虑使用<strong>vw</strong>到我们的适配布局中。<br><img src="https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-4.png" alt="图1:界面区域图"></p>
<h3 id="1-2-⚠️移动设备中1px不等于1个物理像素"><a href="#1-2-⚠️移动设备中1px不等于1个物理像素" class="headerlink" title="1.2 ⚠️移动设备中1px不等于1个物理像素"></a>1.2 ⚠️移动设备中1px不等于1个物理像素</h3><p>如今，移动设备大多采用高倍屏，像素分辨率(物理)要比逻辑分辨率高，如下表：</p>
<table>
<thead>
<tr>
<th>型号</th>
<th>像素分辨率</th>
<th>逻辑分辨率</th>
<th>倍率</th>
</tr>
</thead>
<tbody><tr>
<td>iPhone5</td>
<td>640*1136</td>
<td>320*568</td>
<td>2</td>
</tr>
<tr>
<td>iPhone6</td>
<td>750*1334</td>
<td>375*667</td>
<td>2</td>
</tr>
<tr>
<td>iPhone6 plus</td>
<td>1242*2208</td>
<td>414*736</td>
<td>3</td>
</tr>
</tbody></table>
<p>通过如下代码设置viewport宽度 等于 逻辑分辨率宽度(width=device-width)</p>
<pre><code class="html">&lt;meta id=&quot;viewport&quot; name=&quot;viewport&quot; content=&quot;width=device-width; initial-scale=1.0; maximum-scale=1; user-scalable=no;&quot;&gt;</code></pre>
<p>此时，CSS中的1px是不等于一个物理像素的，而是等于倍率个物理像素。</p>
<h3 id="1-3-利用meta标签对viewport进行控制"><a href="#1-3-利用meta标签对viewport进行控制" class="headerlink" title="1.3 利用meta标签对viewport进行控制"></a>1.3 利用meta标签对viewport进行控制</h3><pre><code class="html">&lt;meta id=&quot;viewport&quot; name=&quot;viewport&quot; content=&quot;width=device-width; initial-scale=1.0; maximum-scale=1; user-scalable=no;&quot;&gt;</code></pre>
<table>
<thead>
<tr>
<th>属性名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>width</td>
<td>设置viewport的宽度，为一个正整数，或字符串”width-device”</td>
</tr>
<tr>
<td>initial-scale</td>
<td>设置页面的初始缩放值，为一个数字，可以带小数</td>
</tr>
<tr>
<td>minimum-scale</td>
<td>允许用户的最小缩放值，为一个数字，可以带小数</td>
</tr>
<tr>
<td>maximum-scale</td>
<td>允许用户的最大缩放值，为一个数字，可以带小数</td>
</tr>
<tr>
<td>height</td>
<td>设置viewport的高度，这个属性对我们并不重要，很少使用</td>
</tr>
<tr>
<td>user-scalable</td>
<td>是否允许用户进行缩放，值为”no”或”yes”, no 代表不允许，yes代表允许</td>
</tr>
</tbody></table>
<h3 id="1-4-viewport相关单位"><a href="#1-4-viewport相关单位" class="headerlink" title="1.4 viewport相关单位"></a>1.4 viewport相关单位</h3><p><strong>Viewport</strong> 共有四个单位，分别为<code>vw</code> <code>vh</code> <code>vmin</code> <code>vmax</code> </p>
<pre><code class="JS">&lt;meta id=&quot;viewport&quot; name=&quot;viewport&quot; content=&quot;width=device-width; initial-scale=1.0; maximum-scale=1; user-scalable=no;&quot;&gt;</code></pre>
<p>vw：是Viewport’s width的简写，<code>1vw</code>等于<code>window.innerWidth</code> 的<code>1%</code><br>vh： 是Viewport’s height的简写，<code>1vh</code>等于<code>window.innerHeight</code> 的<code>1%</code><br>vmin：<code>vmin</code>取值于当前<code>vw</code> 和 <code>vh</code> 中较小的值<br>vmax：<code>vmax</code>取值于当前<code>vw</code> 和 <code>vh</code> 中较小的值</p>
<h4 id="vmin-和-vmax"><a href="#vmin-和-vmax" class="headerlink" title="vmin 和 vmax"></a>vmin 和 vmax</h4><p>vmin和vmax比较绕，通俗来讲，如果<br><code>window.innerHeight &gt; window.innerWidth</code> 则：</p>
<p><code>vmin</code>取<code>1%</code>的<code>window.innerWidth</code><br><code>vmax</code>取<code>1%</code>的<code>window.innerHeight</code></p>
<p>如下图：<br><img src="https://www.w3cplus.com/sites/default/files/blogs/2017/1707/vw-layout-5.png" alt="img"></p>
<h3 id="1-5-适配支持机型"><a href="#1-5-适配支持机型" class="headerlink" title="1.5 适配支持机型"></a>1.5 适配支持机型</h3><p>测试手上机型是否支持 <code>Viewport</code> :<a href="https://www.w3.org/TR/css3-values/" target="_blank" rel="noopener">点击这里</a><br>Top30机型中，未得到支持的如下<br>目前大部分手机浏览器已支持<code>viewport</code>，不需要额外做过多的兼容处理，如果业务特殊需要，也可通过插件方式进行降级处理，文末有简单介绍<br><img src="https://i.loli.net/2019/04/10/5cad4ec8904fd.png" alt="WX20190410-075624@2x"></p>
<h2 id="2-在项目中使用-Viewport"><a href="#2-在项目中使用-Viewport" class="headerlink" title="2. 在项目中使用 Viewport"></a>2. 在项目中使用 <code>Viewport</code></h2><p>以下几个插件的使用方式可参考：<a href="https://juejin.im/post/5c10e8386fb9a049e82b60e5" target="_blank" rel="noopener">使用vw适配移动端</a><br>一般我们出视觉设计稿,都是基于iPhone 6屏幕来进行设计,也就是宽度为<code>750px</code>，从上面原理来看，我们可以得出：<code>100vw = 750px</code>,也就是 <code>1vw = 7.5px</code></p>
<h3 id="2-1-自动转换px为vw"><a href="#2-1-自动转换px为vw" class="headerlink" title="2.1 自动转换px为vw"></a>2.1 自动转换px为vw</h3><p>如上所见，我们就可以根据设计稿的<code>px</code>来转换为对应的<code>vw</code>值<br>但是，难道全部都需要我们手动转换？<br>当然不是，我们可以引入<code>PostCSS</code>插件<code>postcss-px-to-viewport</code>进行自动转换<br>这样我们就可以在代码中直接写<code>px</code>,这样岂不是很棒么。</p>
<h6 id="举个例子："><a href="#举个例子：" class="headerlink" title="举个例子："></a>举个例子：</h6><pre><code class="css"> .box{
     width: 369px;
 }</code></pre>
<p> 经过PostCSS编译后变成了我们想要的<code>vw</code>代码</p>
<pre><code class="css"> .box{
     width: 49.2vw;
 }</code></pre>
<p>还可以根据实际项目对插件进行配置,参阅<a href="https://github.com/evrone/postcss-px-to-viewport" target="_blank" rel="noopener">官方文档</a></p>
<pre><code class="json">&quot;postcss-px-to-viewport&quot;: {
    viewportWidth: 750, // 视窗的宽度，对应的是我们设计稿的宽度，一般是750
    viewportHeight: 1334, // 视窗的高度，根据750设备的宽度来指定，一般指定1334，也可以不配置
    unitPrecision: 3, // 指定`px`转换为视窗单位值的小数位数（很多时候无法整除）
    viewportUnit: &#39;vw&#39;, // 指定需要转换成的视窗单位，建议使用vw
    selectorBlackList: [&#39;.ignore&#39;, &#39;.hairlines&#39;], // 指定不转换为视窗单位的类，可以自定义，可以无限添加,建议定义一至两个通用的类名
    minPixelValue: 1, // 小于或等于`1px`不转换为视窗单位，你也可以设置为你想要的值
    mediaQuery: false // 允许在媒体查询中转换`px`
}</code></pre>
<p>上面解决了<code>px</code>到<code>vw</code>的转换计算。根据相关的测试，在以下这些地方可以使用<code>vw</code>来适配我们的页面。</p>
<ul>
<li>容器适配，可以使用<code>vw</code></li>
<li>文本的适配，可以使用<code>vw</code></li>
<li>大于<code>1px</code>的边框、圆角、阴影都可以使用<code>vw</code></li>
<li>内距和外距，可以使用<code>vw</code></li>
</ul>
<h3 id="2-2-Retina屏实现1px边框线"><a href="#2-2-Retina屏实现1px边框线" class="headerlink" title="2.2 Retina屏实现1px边框线"></a>2.2 Retina屏实现1px边框线</h3><blockquote>
<p>参考资料：<a href="https://www.w3cplus.com/css/fix-1px-for-retina.html" target="_blank" rel="noopener">再谈Retina下1px的解决方案</a></p>
</blockquote>
<p>目前最常用的还是通过<code>PostCSS</code> 插件 <code>postcss-write-svg</code>来解决这个问题，自动生成<code>border-image</code>或者<code>background-image</code>的图片</p>
<h5 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h5><pre><code class="powershell">npm i -S postcss-write-svg</code></pre>
<h5 id="在代码中使用-两种方式-："><a href="#在代码中使用-两种方式-：" class="headerlink" title="在代码中使用(两种方式)："></a>在代码中使用(两种方式)：</h5><ol>
<li><code>border-image</code></li>
</ol>
<pre><code class="css">/* 建立通用样式 */
@svg 1px-border {
   height: 2px; 
   @rect { 
       fill: var(--color, black); 
       width: 100%; 
       height: 50%; 
    }
 } 
 /* 使用 */
 .example {
     border: 1px solid transparent;
     border-image: svg(1px-border param(--color #00b1ff)) 2 2 stretch;
 }</code></pre>
<p>PostCSS 会自动帮我们编译出来：</p>
<pre><code class="css">.example {
    border: 1px solid transparent;
    border-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; height=&#39;2px&#39;%3E%3Crect fill=&#39;%2300b1ff&#39; width=&#39;100%25&#39; height=&#39;50%25&#39;/%3E%3C/svg%3E&quot;) 2 2 stretch;
}</code></pre>
<ol start="2">
<li><code>background-image</code></li>
</ol>
<pre><code class="css">/* 建立通用样式 */
@svg square {
    @rect {
        fill: var(--color, black);
        width: 100%;
        height: 100%;
    }
}
/* 使用 */

#example {
    background: white svg(square param(--color #00b1ff));
}</code></pre>
<p>经过PostCSS编译后：</p>
<pre><code class="css">#example {
    background: white url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39;%3E%3Crect fill=&#39;%2300b1ff&#39; width=&#39;100%25&#39; height=&#39;100%25&#39;/%3E%3C/svg%3E&quot;);
}</code></pre>
<h3 id="2-3-降级处理"><a href="#2-3-降级处理" class="headerlink" title="2.3 降级处理"></a>2.3 降级处理</h3><p>前面提到过，到目前为止，T30的机型中还有几款机型是不支持<code>vw</code>的适配方案，一般来说我们已经不需要再去兼容，但是如果业务需要，应该怎么处理呢？有两种方式可以进行降级处理： </p>
<ul>
<li><strong>CSS Houdini</strong>：通过<a href="https://github.com/w3c/css-houdini-drafts/wiki" target="_blank" rel="noopener">CSS Houdini</a>针对<code>vw</code>做处理，调用<a href="https://www.w3.org/TR/css-typed-om-1" target="_blank" rel="noopener">CSS Typed OM Level1</a>  提供的<a href="https://www.w3.org/TR/css-typed-om-1/#numericvalue-serialization" target="_blank" rel="noopener"><code>CSSUnitValue</code>  API</a>。</li>
<li><strong>CSS Polyfill</strong>：通过相应的Polyfill做相应的处理，目前针对于<code>vw</code>单位的Polyfill主要有：<a href="https://github.com/saabi/vminpoly" target="_blank" rel="noopener">vminpoly</a>、<a href="https://github.com/rodneyrehm/viewport-units-buggyfill" target="_blank" rel="noopener">Viewport Units Buggyfill</a>、<a href="https://gist.github.com/LeaVerou/1347501" target="_blank" rel="noopener">vunits.js</a>和<a href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills" target="_blank" rel="noopener">Modernizr</a>。个人推荐采用<a href="https://github.com/rodneyrehm/viewport-units-buggyfill" target="_blank" rel="noopener">Viewport Units Buggyfill</a></li>
</ul>
<h5 id="使用Viewport-Units-Buggyfill"><a href="#使用Viewport-Units-Buggyfill" class="headerlink" title="使用Viewport Units Buggyfill"></a>使用Viewport Units Buggyfill</h5><ol>
<li>在<code>vue</code>项目的<code>index.html</code>文件<code>head</code>标签添加引用  </li>
</ol>
<pre><code class="css">&lt;script src=&quot;//g.alicdn.com/fdilab/lib3rd/viewport-units-buggyfill/0.6.2/??viewport-units-buggyfill.hacks.min.js,viewport-units-buggyfill.min.js&quot;&gt;&lt;/script&gt;</code></pre>
<ol start="2">
<li>在<code>index.html</code>文件<code>body</code>标签后添加以下代码</li>
</ol>
<pre><code class="javascript">&lt;script&gt;
  // vw兼容性处理viewport-units-buggyfill
    window.onload = function () {
      window.viewportUnitsBuggyfill.init({ hacks: window.viewportUnitsBuggyfillHacks });
      //以下代码用户测试
      // var winDPI = window.devicePixelRatio;
      // var uAgent = window.navigator.userAgent;
      // var screenHeight = window.screen.height;
      // var screenWidth = window.screen.width;
      // var winWidth = window.innerWidth;
      // var winHeight = window.innerHeight;
      // console.log(&quot;Windows DPI:&quot; + winDPI + &quot;;\ruAgent:&quot; + uAgent + &quot;;\rScreen Width:&quot; +
      //   screenWidth + &quot;;\rScreen Height:&quot; + screenHeight + &quot;;\rWindow Width:&quot; + winWidth +
      //   &quot;;\rWindow Height:&quot; + winHeight)
    }
  &lt;/script&gt;</code></pre>
<ol start="3">
<li><p>具体的使用。在你的CSS中，只要使用到了viewport的单位（vw、vh、vmin或vmax ）地方，需要在样式中添加content：</p>
<pre><code class="javascript">.my-viewport-units-using-thingie {
   width: 50vmin;
   height: 50vmax;
   top: calc(50vh - 100px);
   left: calc(50vw - 100px);
   /* hack to engage viewport-units-buggyfill */
   content: &#39;viewport-units-buggyfill; width: 50vmin; height: 50vmax; top: calc(50vh - 100px); left: calc(50vw - 100px);&#39;;
}</code></pre>
</li>
</ol>
<p>不可能每次写vw都去手动的计算。特别是在我们的这个场景中，使用了postcss-px-to-viewport这个插件来转换vw，更无法让我们手动的去添加content内容。 这个时候就需要前面提到的postcss-viewport-units插件。这个插件将让你无需关注content的内容，插件会自动帮你处理。<br>兼容方面，具体可参阅<a href="https://www.w3cplus.com/mobile/vw-layout-in-vue.html" target="_blank" rel="noopener">如何在Vue项目中使用vw实现移动端适配</a></p>

  </article>
  <footer class="f-cf">
    
      <a href="/2019/09/28/first-article/" class="link f-fl">⟵first article</a>
    
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  
  
  <span class="copyright">All rights reserved @shaonian.gui</span>
</footer>
  </div>
</body>
</html>